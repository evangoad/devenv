#!/usr/bin/env python

import os
import subprocess
import sys
import optparse

def run_playbook(playbook):
    print("devenv detected {0}. running command:".format(playbook))
    command = ["ansible-playbook", os.path.expanduser("~/.devenv/playbooks/{0}.yml".format(playbook)), "-i", os.path.expanduser("~/.devenv/playbooks/inventory")]
    print str(" ".join(command))
    subprocess.check_call(command)

def update_repo():
    origWD = os.getcwd()
    os.chdir(os.path.expanduser("~/.devenv"))
    subprocess.check_call(["git", "pull"])
    os.chdir(origWD)

def main():
    p = optparse.OptionParser(version='devenv 0.0.3',usage="usage: devenv [options]\n default behavior is to install applications and symlink dotfiles")
    options, arguments = p.parse_args()
    if len(arguments) == 0:
        update_repo()
        if os.uname()[0] == "Linux":
            run_playbook("ubuntu")
        else:
            run_playbook("osx")
    else:
        p.print_help()


if __name__ == '__main__':
  main()
